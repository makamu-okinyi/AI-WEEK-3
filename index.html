<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MNIST Digit Recognizer (Flask)</title>
    <style>
        body { font-family: sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; background-color: #f0f0f0; }
        .container { text-align: center; background-color: white; padding: 2rem; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        h1 { margin-bottom: 1rem; }
        canvas { border: 2px solid #333; cursor: crosshair; margin-bottom: 1rem; }
        button { padding: 0.75rem 1.5rem; font-size: 1rem; cursor: pointer; border-radius: 5px; border: none; }
        #predict-btn { background-color: #007bff; color: white; }
        #clear-btn { background-color: #6c757d; color: white; }
        #prediction-result { font-size: 1.5rem; margin-top: 1rem; font-weight: bold; color: #28a745; }
    </style>
</head>
<body>

<div class="container">
    <h1>✏️ Draw a Digit (0-9)</h1>
    <canvas id="canvas" width="280" height="280"></canvas>
    <div>
        <button id="predict-btn">Predict</button>
        <button id="clear-btn">Clear</button>
    </div>
    <div id="prediction-result">Prediction will appear here</div>
</div>

<script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const resultDiv = document.getElementById('prediction-result');
    let isDrawing = false;

    // Set canvas background to black and drawing color to white
    ctx.fillStyle = "black";
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.strokeStyle = "white";
    ctx.lineWidth = 20;
    ctx.lineCap = 'round'; // Makes the line ends smooth

    function startDrawing(e) {
        isDrawing = true;
        draw(e);
    }

    function stopDrawing() {
        isDrawing = false;
        ctx.beginPath();
    }

    function draw(e) {
        if (!isDrawing) return;
        const rect = canvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;

        ctx.lineTo(x, y);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(x, y);
    }

    function clearCanvas() {
        ctx.fillStyle = "black";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        resultDiv.innerText = "Prediction will appear here";
        resultDiv.style.color = '#6c757d';
    }

    async function predict() {
        // Get the image data from the canvas as a data URL (base64 encoded)
        const imageData = canvas.toDataURL('image/png');
        
        // Send this data to our Flask backend
        const response = await fetch('/predict', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ image_data: imageData })
        });
        
        const data = await response.json();
        
        // Display the result
        resultDiv.innerText = `Predicted: ${data.predicted_digit} (${(data.confidence * 100).toFixed(2)}%)`;
        resultDiv.style.color = '#28a745';
    }

    // Event Listeners
    canvas.addEventListener('mousedown', startDrawing);
    canvas.addEventListener('mouseup', stopDrawing);
    canvas.addEventListener('mousemove', draw);
    document.getElementById('predict-btn').addEventListener('click', predict);
    document.getElementById('clear-btn').addEventListener('click', clearCanvas);
</script>
</body>
</html>